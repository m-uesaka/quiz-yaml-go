# YAMLファイル作成ガイド

このガイドでは、Quiz YAML Goアプリケーションで使用するYAMLファイルの作成方法について説明します．

## スキーマ概要

YAMLファイルは配列形式で、各要素がクイズの1問を表します。スキーマの詳細は`quiz.json`で定義されています。

## 基本構造

```yaml
- question: "問題文"
  answer: "答え"
  spell: "原語表記（英語など）"
  comments:
    - "コメント1"
    - "コメント2"
  criteria:
    ok:
      - "正解として扱う別解1"
      - "正解として扱う別解2"
    ng:
      - "誤答として明示的に判定する答え"
    repeat:
      - "もう一度回答を求める答え"
```

## フィールド詳細

### 必須フィールド

| フィールド | 型 | 説明 | 例 |
|-----------|---|------|-----|
| `question` | string | 問題文 | `"日本の首都は？"` |
| `answer` | string | 基本の答え | `"東京"` |

### オプションフィールド

| フィールド | 型 | 説明 | 例 |
|-----------|---|------|-----|
| `spell` | string | 原語表記（英語表記など） | `"Tokyo"` |
| `comments` | array[string] | 問題に関するコメント | `["首都機能は分散している"]` |
| `criteria` | object | 正誤判定基準 | 下記参照 |

### criteriaオブジェクト

正誤判定の詳細な基準を定義します。

| フィールド | 型 | 説明 |
|-----------|---|------|
| `ok` | array[string] | 正解として扱う別解 |
| `ng` | array[string] | 誤答として明示的に判定する答え |
| `repeat` | array[string] | もう一度回答を求める答え |

## 作成時のポイント

### 1. 文字エンコーディング
- ファイルはUTF-8で保存してください
- BOMは付けないでください

### 2. インデント
- YAML形式では**スペース**を使用してください（タブは使用しない）
    - Visual Studio Codeなどのエディタでは，設定でタブ入力を自動的にスペースへ変換することができます．
- インデントは一貫して2スペースまたは4スペースを使用．

### 3. 文字列の扱い
- 日本語文字列は引用符で囲まなくても大丈夫です．
- 特殊文字や記号が含まれる場合は引用符で囲んでください．
    - 特殊文字の例: `:`, `-`, `#` など．

### 4. 配列の書き方

`yaml`では配列を以下の2つの形式で記述できます．

```yaml
# リスト形式（推奨）
comments:
  - "コメント1"
  - "コメント2"

# インライン形式
comments: ["コメント1", "コメント2"]
```

読みやすさの観点から，リスト形式での記述を推奨します．

### 5. 鍵括弧の扱い

変換スクリプトでは，`criteria`の中の鍵括弧（「」）を以下のように処理しています．

- 「」で囲われている場合，それ以上は何もしません．
  - これは，閉じ鍵括弧の後に何か文字列が続く場合も含みます．
  - 例: `「正解」`，`「正解」（別名）`
- 「」で囲まれていない場合は，文字列全体を「」で囲みます．
  - 例: `正解` → `「正解」`，`正解（別名）` → `「正解（別名）」`

そのため，鍵括弧は特に使用する必要はありませんが，使う場合は上記ルールを頭に入れておいてください．

## バリデーション

作成したYAMLファイルは以下のコマンドで検証できます：

```bash
# go runを使用
go run main.go -input quiz.yaml -validate

# ビルド済みバイナリを使用
go build -o quiz-yaml-converter
./quiz-yaml-converter -input quiz.yaml -validate
```

## トラブルシューティング

### よくあるエラー

1. **YAML構文エラー**
   - インデントが正しくない
   - コロン（:）の後にスペースがない
   - Visual Studio Codeなどのエディタを使う場合，プラグインを入れてYAML構文をチェックすることをおすすめします．

2. **スキーマ検証エラー**
   - 必須フィールド（question, answer）が未定義
   - データ型が間違っている

3. **文字エンコーディングエラー**
   - ファイルがUTF-8以外で保存されている

### デバッグ方法

```bash
# 詳細なエラー出力
go run main.go -input problem_file.yaml -output debug.csv 2>&1

# YAMLパーサーでの直接確認
go run -c "package main; import \"gopkg.in/yaml.v3\"; /* 確認コード */"
```

## 参考資料

- [YAML公式仕様](https://yaml.org/spec/)
- [Go YAML v3ドキュメント](https://pkg.go.dev/gopkg.in/yaml.v3)
- プロジェクトのJSONスキーマ: `quiz.json`
